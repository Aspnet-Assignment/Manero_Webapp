@page "/profile"
@rendermode InteractiveServer
@using Manero_WebApp.Components.Layout
@using Manero_WebApp.Data
@using Microsoft.AspNetCore.Identity
@using Microsoft.AspNetCore.Components.Authorization
@inject SignInManager<ApplicationUser> SignInManager
@inject UserManager<ApplicationUser> UserManager
@inject NavigationManager Navigation
@inject AuthenticationStateProvider AuthenticationStateProvider
@layout MainLayout

<PageTitle>Your Profile</PageTitle>

<section class="profile-home">
    <div class="profile-info">
        @if (user != null)
        {
            <p>placeholder profile pic</p>
            <h3>@user.FirstName @user.LastName</h3>
            <p>@user.Email</p>
        }
        else
        {
            <p>Loading...</p>
        }
    </div>
    <div class="profile-rows">
        <a class="button-row" href="/welcome">
            <div class="button-icon">
                <img src="/images/profile/calendar.svg" />
            </div>
            <div class="button-text">
                <p>Order History</p>
            </div>
            <div class="button-arrow">
                <img src="/images/profile/small_arrow.svg" />
            </div>
        </a>

        <a class="button-row" href="/profile/payment">
            <div class="button-icon">
                <img src="/images/profile/card.svg" />
            </div>
            <div class="button-text">
                <p>Payment Method</p>
            </div>
            <div class="button-arrow">
                <img src="/images/profile/small_arrow.svg" />
            </div>
        </a>

        <div class="button-row">
            <div class="button-icon">
                <img src="/images/profile/map_pin.svg" />
            </div>
            <div class="button-text">
                <p>My Address</p>
            </div>
            <div class="button-arrow">
                <img src="/images/profile/small_arrow.svg" />
            </div>
        </div>

        <div class="button-row">
            <div class="button-icon">
                <img src="/images/profile/gift.svg" />
            </div>
            <div class="button-text">
                <p>My Promocodes</p>
            </div>
            <div class="button-arrow">
                <img src="/images/profile/small_arrow.svg" />
            </div>
        </div>

        <div class="button-row" @onclick="Logout">
            <div class="button-icon">
                <img src="/images/profile/log_out.svg" />
            </div>
            <div class="button-text">
                <p>Sign Out</p>
            </div>
        </div>
    </div>
</section>

@code {
    private ApplicationUser user;

    protected override async Task OnInitializedAsync()
    {
        var authState = await AuthenticationStateProvider.GetAuthenticationStateAsync();
        var userPrincipal = authState.User;

        if (SignInManager.IsSignedIn(userPrincipal))
        {
            user = await UserManager.GetUserAsync(userPrincipal);
        }
    }

    private async Task Logout()
    {
        await SignInManager.SignOutAsync();
        Navigation.NavigateTo("/");
    }
}
